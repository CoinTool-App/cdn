(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21ab5c"],{bd59:function(e,t,n){"use strict";n.d(t,"a",(function(){return B}));var i,o,r,s,a=n("3835"),c=(n("2909"),n("b85c")),u=n("53ca"),h=n("d4ec"),l=n("bee2"),f=(n("c73d"),n("14d9"),n("d3b7"),n("159b"),n("4de4"),n("99af"),n("d9e2"),n("b64b"),n("a15b"),n("ac1f"),n("466d"),n("ace4"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("986a"),n("1d02"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("6ce5"),n("2834"),n("72f7"),n("4ea1"),n("313d"),n("0eb6"),n("b7ef"),n("8bd4"),n("6062"),n("3ca3"),n("ddb0"),n("5319"),n("4d63"),n("c607"),n("2c3e"),n("25f0"),n("d81d"),n("7039"),n("e9c4"),n("c19f"),n("a630"),n("fb6a"),n("7db0"),function(e){if("function"===typeof e)return e;var t=function(){return e};return t}),d="undefined"!==typeof self?self:null,v="undefined"!==typeof window?window:null,p=d||v||p,g="2.0.0",m={connecting:0,open:1,closing:2,closed:3},b=1e4,k=1e3,y={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},E={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},T={longpoll:"longpoll",websocket:"websocket"},C={complete:4},j=function(){function e(t,n,i,o){Object(h["a"])(this,e),this.channel=t,this.event=n,this.payload=i||function(){return{}},this.receivedResp=null,this.timeout=o,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}return Object(l["a"])(e,[{key:"resend",value:function(e){this.timeout=e,this.reset(),this.send()}},{key:"send",value:function(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}},{key:"receive",value:function(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}},{key:"reset",value:function(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}},{key:"matchReceive",value:function(e){var t=e.status,n=e.response;e._ref;this.recHooks.filter((function(e){return e.status===t})).forEach((function(e){return e.callback(n)}))}},{key:"cancelRefEvent",value:function(){this.refEvent&&this.channel.off(this.refEvent)}},{key:"cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}},{key:"startTimeout",value:function(){var e=this;this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,(function(t){e.cancelRefEvent(),e.cancelTimeout(),e.receivedResp=t,e.matchReceive(t)})),this.timeoutTimer=setTimeout((function(){e.trigger("timeout",{})}),this.timeout)}},{key:"hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}},{key:"trigger",value:function(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}]),e}(),R=function(){function e(t,n){Object(h["a"])(this,e),this.callback=t,this.timerCalc=n,this.timer=null,this.tries=0}return Object(l["a"])(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),w=function(){function e(t,n,i){var o=this;Object(h["a"])(this,e),this.state=y.closed,this.topic=t,this.params=f(n||{}),this.socket=i,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new j(this,E.join,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new R((function(){o.socket.isConnected()&&o.rejoin()}),this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError((function(){return o.rejoinTimer.reset()}))),this.stateChangeRefs.push(this.socket.onOpen((function(){o.rejoinTimer.reset(),o.isErrored()&&o.rejoin()}))),this.joinPush.receive("ok",(function(){o.state=y.joined,o.rejoinTimer.reset(),o.pushBuffer.forEach((function(e){return e.send()})),o.pushBuffer=[]})),this.joinPush.receive("error",(function(){o.state=y.errored,o.socket.isConnected()&&o.rejoinTimer.scheduleTimeout()})),this.onClose((function(){o.rejoinTimer.reset(),o.socket.hasLogger()&&o.socket.log("channel","close ".concat(o.topic," ").concat(o.joinRef())),o.state=y.closed,o.socket.remove(o)})),this.onError((function(e){o.socket.hasLogger()&&o.socket.log("channel","error ".concat(o.topic),e),o.isJoining()&&o.joinPush.reset(),o.state=y.errored,o.socket.isConnected()&&o.rejoinTimer.scheduleTimeout()})),this.joinPush.receive("timeout",(function(){o.socket.hasLogger()&&o.socket.log("channel","timeout ".concat(o.topic," (").concat(o.joinRef(),")"),o.joinPush.timeout);var e=new j(o,E.leave,f({}),o.timeout);e.send(),o.state=y.errored,o.joinPush.reset(),o.socket.isConnected()&&o.rejoinTimer.scheduleTimeout()})),this.on(E.reply,(function(e,t){o.trigger(o.replyEventName(t),e)}))}return Object(l["a"])(e,[{key:"join",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}},{key:"onClose",value:function(e){this.on(E.close,e)}},{key:"onError",value:function(e){return this.on(E.error,(function(t){return e(t)}))}},{key:"on",value:function(e,t){var n=this.bindingRef++;return this.bindings.push({event:e,ref:n,callback:t}),n}},{key:"off",value:function(e,t){this.bindings=this.bindings.filter((function(n){return!(n.event===e&&("undefined"===typeof t||t===n.ref))}))}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(t=t||{},!this.joinedOnce)throw new Error("tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.join() before pushing events"));var i=new j(this,e,(function(){return t}),n);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}},{key:"leave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=y.leaving;var n=function(){e.socket.hasLogger()&&e.socket.log("channel","leave ".concat(e.topic)),e.trigger(E.close,"leave")},i=new j(this,E.leave,f({}),t);return i.receive("ok",(function(){return n()})).receive("timeout",(function(){return n()})),i.send(),this.canPush()||i.trigger("ok",{}),i}},{key:"onMessage",value:function(e,t,n){return t}},{key:"isMember",value:function(e,t,n,i){return this.topic===e&&(!i||i===this.joinRef()||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:n,joinRef:i}),!1))}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=y.joining,this.joinPush.resend(e))}},{key:"trigger",value:function(e,t,n,i){var o=this.onMessage(e,t,n,i);if(t&&!o)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");for(var r=this.bindings.filter((function(t){return t.event===e})),s=0;s<r.length;s++){var a=r[s];a.callback(o,n,i||this.joinRef())}}},{key:"replyEventName",value:function(e){return"chan_reply_".concat(e)}},{key:"isClosed",value:function(){return this.state===y.closed}},{key:"isErrored",value:function(){return this.state===y.errored}},{key:"isJoined",value:function(){return this.state===y.joined}},{key:"isJoining",value:function(){return this.state===y.joining}},{key:"isLeaving",value:function(){return this.state===y.leaving}}]),e}(),A=function(){function e(){Object(h["a"])(this,e)}return Object(l["a"])(e,null,[{key:"request",value:function(e,t,n,i,o,r,s){if(p.XDomainRequest){var a=new p.XDomainRequest;return this.xdomainRequest(a,e,t,i,o,r,s)}var c=new p.XMLHttpRequest;return this.xhrRequest(c,e,t,n,i,o,r,s)}},{key:"xdomainRequest",value:function(e,t,n,i,o,r,s){var a=this;return e.timeout=o,e.open(t,n),e.onload=function(){var t=a.parseJSON(e.responseText);s&&s(t)},r&&(e.ontimeout=r),e.onprogress=function(){},e.send(i),e}},{key:"xhrRequest",value:function(e,t,n,i,o,r,s,a){var c=this;return e.open(t,n,!0),e.timeout=r,e.setRequestHeader("Content-Type",i),e.onerror=function(){return a&&a(null)},e.onreadystatechange=function(){if(e.readyState===C.complete&&a){var t=c.parseJSON(e.responseText);a(t)}},s&&(e.ontimeout=s),e.send(o),e}},{key:"parseJSON",value:function(e){if(!e||""===e)return null;try{return JSON.parse(e)}catch(I){return console&&console.log("failed to parse JSON response",e),null}}},{key:"serialize",value:function(e,t){var n=[];for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=t?"".concat(t,"[").concat(i,"]"):i,r=e[i];"object"===Object(u["a"])(r)?n.push(this.serialize(r,o)):n.push(encodeURIComponent(o)+"="+encodeURIComponent(r))}return n.join("&")}},{key:"appendParams",value:function(e,t){if(0===Object.keys(t).length)return e;var n=e.match(/\?/)?"&":"?";return"".concat(e).concat(n).concat(this.serialize(t))}}]),e}(),L=function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,o=0;o<i;o++)t+=String.fromCharCode(n[o]);return btoa(t)},O=function(){function e(t){Object(h["a"])(this,e),this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.reqs=new Set,this.awaitingBatchAck=!1,this.currentBatch=null,this.currentBatchTimer=null,this.batchBuffer=[],this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=m.connecting,this.poll()}return Object(l["a"])(e,[{key:"normalizeEndpoint",value:function(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+T.websocket),"$1/"+T.longpoll)}},{key:"endpointURL",value:function(){return A.appendParams(this.pollEndpoint,{token:this.token})}},{key:"closeAndRetry",value:function(e,t,n){this.close(e,t,n),this.readyState=m.connecting}},{key:"ontimeout",value:function(){this.onerror("timeout"),this.closeAndRetry(1005,"timeout",!1)}},{key:"isActive",value:function(){return this.readyState===m.open||this.readyState===m.connecting}},{key:"poll",value:function(){var e=this;this.ajax("GET","application/json",null,(function(){return e.ontimeout()}),(function(t){if(t){var n=t.status,i=t.token,o=t.messages;e.token=i}else n=0;switch(n){case 200:o.forEach((function(t){setTimeout((function(){return e.onmessage({data:t})}),0)})),e.poll();break;case 204:e.poll();break;case 410:e.readyState=m.open,e.onopen({}),e.poll();break;case 403:e.onerror(403),e.close(1008,"forbidden",!1);break;case 0:case 500:e.onerror(500),e.closeAndRetry(1011,"internal server error",500);break;default:throw new Error("unhandled poll status ".concat(n))}}))}},{key:"send",value:function(e){var t=this;"string"!==typeof e&&(e=L(e)),this.currentBatch?this.currentBatch.push(e):this.awaitingBatchAck?this.batchBuffer.push(e):(this.currentBatch=[e],this.currentBatchTimer=setTimeout((function(){t.batchSend(t.currentBatch),t.currentBatch=null}),0))}},{key:"batchSend",value:function(e){var t=this;this.awaitingBatchAck=!0,this.ajax("POST","application/x-ndjson",e.join("\n"),(function(){return t.onerror("timeout")}),(function(e){t.awaitingBatchAck=!1,e&&200===e.status?t.batchBuffer.length>0&&(t.batchSend(t.batchBuffer),t.batchBuffer=[]):(t.onerror(e&&e.status),t.closeAndRetry(1011,"internal server error",!1))}))}},{key:"close",value:function(e,t,n){var i,o=Object(c["a"])(this.reqs);try{for(o.s();!(i=o.n()).done;){var r=i.value;r.abort()}}catch(a){o.e(a)}finally{o.f()}this.readyState=m.closed;var s=Object.assign({code:1e3,reason:void 0,wasClean:!0},{code:e,reason:t,wasClean:n});this.batchBuffer=[],clearTimeout(this.currentBatchTimer),this.currentBatchTimer=null,"undefined"!==typeof CloseEvent?this.onclose(new CloseEvent("close",s)):this.onclose(s)}},{key:"ajax",value:function(e,t,n,i,o){var r,s=this,a=function(){s.reqs.delete(r),i()};r=A.request(e,this.endpointURL(),t,n,this.timeout,a,(function(e){s.reqs.delete(r),s.isActive()&&o(e)})),this.reqs.add(r)}}]),e}(),S={HEADER_LENGTH:1,META_LENGTH:4,KINDS:{push:0,reply:1,broadcast:2},encode:function(e,t){if(e.payload.constructor===ArrayBuffer)return t(this.binaryEncode(e));var n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))},decode:function(e,t){if(e.constructor===ArrayBuffer)return t(this.binaryDecode(e));var n=JSON.parse(e),i=Object(a["a"])(n,5),o=i[0],r=i[1],s=i[2],c=i[3],u=i[4];return t({join_ref:o,ref:r,topic:s,event:c,payload:u})},binaryEncode:function(e){var t=e.join_ref,n=e.ref,i=e.event,o=e.topic,r=e.payload,s=this.META_LENGTH+t.length+n.length+o.length+i.length,a=new ArrayBuffer(this.HEADER_LENGTH+s),c=new DataView(a),u=0;c.setUint8(u++,this.KINDS.push),c.setUint8(u++,t.length),c.setUint8(u++,n.length),c.setUint8(u++,o.length),c.setUint8(u++,i.length),Array.from(t,(function(e){return c.setUint8(u++,e.charCodeAt(0))})),Array.from(n,(function(e){return c.setUint8(u++,e.charCodeAt(0))})),Array.from(o,(function(e){return c.setUint8(u++,e.charCodeAt(0))})),Array.from(i,(function(e){return c.setUint8(u++,e.charCodeAt(0))}));var h=new Uint8Array(a.byteLength+r.byteLength);return h.set(new Uint8Array(a),0),h.set(new Uint8Array(r),a.byteLength),h.buffer},binaryDecode:function(e){var t=new DataView(e),n=t.getUint8(0),i=new TextDecoder;switch(n){case this.KINDS.push:return this.decodePush(e,t,i);case this.KINDS.reply:return this.decodeReply(e,t,i);case this.KINDS.broadcast:return this.decodeBroadcast(e,t,i)}},decodePush:function(e,t,n){var i=t.getUint8(1),o=t.getUint8(2),r=t.getUint8(3),s=this.HEADER_LENGTH+this.META_LENGTH-1,a=n.decode(e.slice(s,s+i));s+=i;var c=n.decode(e.slice(s,s+o));s+=o;var u=n.decode(e.slice(s,s+r));s+=r;var h=e.slice(s,e.byteLength);return{join_ref:a,ref:null,topic:c,event:u,payload:h}},decodeReply:function(e,t,n){var i=t.getUint8(1),o=t.getUint8(2),r=t.getUint8(3),s=t.getUint8(4),a=this.HEADER_LENGTH+this.META_LENGTH,c=n.decode(e.slice(a,a+i));a+=i;var u=n.decode(e.slice(a,a+o));a+=o;var h=n.decode(e.slice(a,a+r));a+=r;var l=n.decode(e.slice(a,a+s));a+=s;var f=e.slice(a,e.byteLength),d={status:l,response:f};return{join_ref:c,ref:u,topic:h,event:E.reply,payload:d}},decodeBroadcast:function(e,t,n){var i=t.getUint8(1),o=t.getUint8(2),r=this.HEADER_LENGTH+2,s=n.decode(e.slice(r,r+i));r+=i;var a=n.decode(e.slice(r,r+o));r+=o;var c=e.slice(r,e.byteLength);return{join_ref:null,ref:null,topic:s,event:a,payload:c}}},_=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(h["a"])(this,e),this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=i.timeout||b,this.transport=i.transport||p.WebSocket||O,this.establishedConnections=0,this.defaultEncoder=S.encode.bind(S),this.defaultDecoder=S.decode.bind(S),this.closeWasClean=!1,this.binaryType=i.binaryType||"arraybuffer",this.connectClock=1,this.transport!==O?(this.encode=i.encode||this.defaultEncoder,this.decode=i.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder);var o=null;v&&v.addEventListener&&(v.addEventListener("pagehide",(function(e){n.conn&&(n.disconnect(),o=n.connectClock)})),v.addEventListener("pageshow",(function(e){o===n.connectClock&&(o=null,n.connect())}))),this.heartbeatIntervalMs=i.heartbeatIntervalMs||3e4,this.rejoinAfterMs=function(e){return i.rejoinAfterMs?i.rejoinAfterMs(e):[1e3,2e3,5e3][e-1]||1e4},this.reconnectAfterMs=function(e){return i.reconnectAfterMs?i.reconnectAfterMs(e):[10,50,100,150,200,250,500,1e3,2e3][e-1]||5e3},this.logger=i.logger||null,this.longpollerTimeout=i.longpollerTimeout||2e4,this.params=f(i.params||{}),this.endPoint="".concat(t,"/").concat(T.websocket),this.vsn=i.vsn||g,this.heartbeatTimeoutTimer=null,this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new R((function(){n.teardown((function(){return n.connect()}))}),this.reconnectAfterMs)}return Object(l["a"])(e,[{key:"getLongPollTransport",value:function(){return O}},{key:"replaceTransport",value:function(e){this.connectClock++,this.closeWasClean=!0,this.reconnectTimer.reset(),this.sendBuffer=[],this.conn&&(this.conn.close(),this.conn=null),this.transport=e}},{key:"protocol",value:function(){return location.protocol.match(/^https/)?"wss":"ws"}},{key:"endPointURL",value:function(){var e=A.appendParams(A.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?"".concat(this.protocol(),":").concat(e):"".concat(this.protocol(),"://").concat(location.host).concat(e)}},{key:"disconnect",value:function(e,t,n){this.connectClock++,this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(e,t,n)}},{key:"connect",value:function(e){var t=this;e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=f(e)),this.conn||(this.connectClock++,this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=function(){return t.onConnOpen()},this.conn.onerror=function(e){return t.onConnError(e)},this.conn.onmessage=function(e){return t.onConnMessage(e)},this.conn.onclose=function(e){return t.onConnClose(e)})}},{key:"log",value:function(e,t,n){this.logger(e,t,n)}},{key:"hasLogger",value:function(){return null!==this.logger}},{key:"onOpen",value:function(e){var t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}},{key:"onClose",value:function(e){var t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}},{key:"onError",value:function(e){var t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}},{key:"onMessage",value:function(e){var t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}},{key:"ping",value:function(e){var t=this;if(!this.isConnected())return!1;var n=this.makeRef(),i=Date.now();this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:n});var o=this.onMessage((function(r){r.ref===n&&(t.off([o]),e(Date.now()-i))}));return!0}},{key:"clearHeartbeats",value:function(){clearTimeout(this.heartbeatTimer),clearTimeout(this.heartbeatTimeoutTimer)}},{key:"onConnOpen",value:function(){this.hasLogger()&&this.log("transport","connected to ".concat(this.endPointURL())),this.closeWasClean=!1,this.establishedConnections++,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach((function(e){var t=Object(a["a"])(e,2),n=t[1];return n()}))}},{key:"heartbeatTimeout",value:function(){var e=this;this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.triggerChanError(),this.closeWasClean=!1,this.teardown((function(){return e.reconnectTimer.scheduleTimeout()}),k,"heartbeat timeout"))}},{key:"resetHeartbeat",value:function(){var e=this;this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,this.clearHeartbeats(),this.heartbeatTimer=setTimeout((function(){return e.sendHeartbeat()}),this.heartbeatIntervalMs))}},{key:"teardown",value:function(e,t,n){var i=this;if(!this.conn)return e&&e();this.waitForBufferDone((function(){i.conn&&(t?i.conn.close(t,n||""):i.conn.close()),i.waitForSocketClosed((function(){i.conn&&(i.conn.onopen=function(){},i.conn.onerror=function(){},i.conn.onmessage=function(){},i.conn.onclose=function(){},i.conn=null),e&&e()}))}))}},{key:"waitForBufferDone",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;5!==n&&this.conn&&this.conn.bufferedAmount?setTimeout((function(){t.waitForBufferDone(e,n+1)}),150*n):e()}},{key:"waitForSocketClosed",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;5!==n&&this.conn&&this.conn.readyState!==m.closed?setTimeout((function(){t.waitForSocketClosed(e,n+1)}),150*n):e()}},{key:"onConnClose",value:function(e){var t=e&&e.code;this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),this.clearHeartbeats(),this.closeWasClean||1e3===t||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((function(t){var n=Object(a["a"])(t,2),i=n[1];return i(e)}))}},{key:"onConnError",value:function(e){this.hasLogger()&&this.log("transport",e);var t=this.transport,n=this.establishedConnections;this.stateChangeCallbacks.error.forEach((function(i){var o=Object(a["a"])(i,2),r=o[1];r(e,t,n)})),(t===this.transport||n>0)&&this.triggerChanError()}},{key:"triggerChanError",value:function(){this.channels.forEach((function(e){e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(E.error)}))}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case m.connecting:return"connecting";case m.open:return"open";case m.closing:return"closing";default:return"closed"}}},{key:"isConnected",value:function(){return"open"===this.connectionState()}},{key:"remove",value:function(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter((function(t){return t.joinRef()!==e.joinRef()}))}},{key:"off",value:function(e){for(var t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter((function(t){var n=Object(a["a"])(t,1),i=n[0];return-1===e.indexOf(i)}))}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new w(e,t,this);return this.channels.push(n),n}},{key:"push",value:function(e){var t=this;if(this.hasLogger()){var n=e.topic,i=e.event,o=e.payload,r=e.ref,s=e.join_ref;this.log("push","".concat(n," ").concat(i," (").concat(s,", ").concat(r,")"),o)}this.isConnected()?this.encode(e,(function(e){return t.conn.send(e)})):this.sendBuffer.push((function(){return t.encode(e,(function(e){return t.conn.send(e)}))}))}},{key:"makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"sendHeartbeat",value:function(){var e=this;this.pendingHeartbeatRef&&!this.isConnected()||(this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatTimeoutTimer=setTimeout((function(){return e.heartbeatTimeout()}),this.heartbeatIntervalMs))}},{key:"flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((function(e){return e()})),this.sendBuffer=[])}},{key:"onConnMessage",value:function(e){var t=this;this.decode(e.data,(function(e){var n=e.topic,i=e.event,o=e.payload,r=e.ref,s=e.join_ref;r&&r===t.pendingHeartbeatRef&&(t.clearHeartbeats(),t.pendingHeartbeatRef=null,t.heartbeatTimer=setTimeout((function(){return t.sendHeartbeat()}),t.heartbeatIntervalMs)),t.hasLogger()&&t.log("receive","".concat(o.status||""," ").concat(n," ").concat(i," ").concat(r&&"("+r+")"||""),o);for(var c=0;c<t.channels.length;c++){var u=t.channels[c];u.isMember(n,i,o,s)&&u.trigger(i,o,r,s)}for(var h=0;h<t.stateChangeCallbacks.message.length;h++){var l=Object(a["a"])(t.stateChangeCallbacks.message[h],2),f=l[1];f(e)}}))}},{key:"leaveOpenTopic",value:function(e){var t=this.channels.find((function(t){return t.topic===e&&(t.isJoined()||t.isJoining())}));t&&(this.hasLogger()&&this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.leave())}}]),e}();function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},I.apply(this,arguments)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}!function(e){e.MAINNET="mainnet",e.TESTNET="testnet"}(i||(i={})),function(e){e.ITEM_METADATA_UPDATED="item_metadata_updated",e.ITEM_LISTED="item_listed",e.ITEM_SOLD="item_sold",e.ITEM_TRANSFERRED="item_transferred",e.ITEM_RECEIVED_OFFER="item_received_offer",e.ITEM_RECEIVED_BID="item_received_bid",e.ITEM_CANCELLED="item_cancelled"}(o||(o={})),function(e){e[e.DEBUG=20]="DEBUG",e[e.INFO=30]="INFO",e[e.WARN=40]="WARN",e[e.ERROR=50]="ERROR"}(r||(r={}));var M=((s={})[i.MAINNET]="wss://stream.openseabeta.com/socket",s[i.TESTNET]="wss://testnets-stream.openseabeta.com/socket",s),B=function(){function e(e){var t=this,n=e.network,s=void 0===n?i.MAINNET:n,a=e.token,c=e.apiUrl,u=e.connectOptions,h=e.logLevel,l=void 0===h?r.INFO:h,f=e.onError,d=void 0===f?function(e){return t.error(e)}:f;this.socket=void 0,this.channels=void 0,this.logLevel=void 0,this.connect=function(){t.debug("Connecting to socket"),t.socket.connect()},this.disconnect=function(e){return void 0===e&&(e=function(){return t.info("Succesfully disconnected from socket")}),t.channels.clear(),t.socket.disconnect(e)},this.createChannel=function(e){var n=t.socket.channel(e);return n.join().receive("ok",(function(){return t.info('Successfully joined channel "'+e+'"')})).receive("error",(function(){return t.error('Failed to join channel "'+e+'"')})),t.channels.set(e,n),n},this.getChannel=function(e){var n=t.channels.get(e);return n||(t.debug('Creating channel for topic: "'+e+'"'),n=t.createChannel(e)),n},this.on=function(e,n,i){t.socket.connect();var o="collection:"+n;t.debug("Fetching channel "+o);var r=t.getChannel(o);return t.debug("Subscribing to "+e+" events on "+o),r.on(e,i),function(){t.debug("Unsubscribing from "+e+" events on "+o),r.leave().receive("ok",(function(){t.channels.delete(o),t.info('Succesfully left channel "'+o+'" listening for '+e)}))}},this.onItemMetadataUpdated=function(e,n){return t.debug('Listening for item metadata updates on "'+e+'"'),t.on(o.ITEM_METADATA_UPDATED,e,n)},this.onItemCancelled=function(e,n){return t.debug('Listening for item cancellations on "'+e+'"'),t.on(o.ITEM_CANCELLED,e,n)},this.onItemListed=function(e,n){return t.debug('Listening for item listings on "'+e+'"'),t.on(o.ITEM_LISTED,e,n)},this.onItemSold=function(e,n){return t.debug('Listening for item sales on "'+e+'"'),t.on(o.ITEM_SOLD,e,n)},this.onItemTransferred=function(e,n){return t.debug('Listening for item transfers on "'+e+'"'),t.on(o.ITEM_TRANSFERRED,e,n)},this.onItemReceivedOffer=function(e,n){return t.debug('Listening for item offers on "'+e+'"'),t.on(o.ITEM_RECEIVED_OFFER,e,n)},this.onItemReceivedBid=function(e,n){return t.debug('Listening for item bids on "'+e+'"'),t.on(o.ITEM_RECEIVED_BID,e,n)},this.onEvents=function(e,n,i){var o=n.map((function(n){return t.on(n,e,i)}));return function(){for(var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(e))){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o);!(e=t()).done;)(0,e.value)()}};var v="undefined"!=typeof window?window.WebSocket:void 0;this.socket=new _(c||M[s],I({params:{token:a},transport:v},u)),this.socket.onError(d),this.channels=new Map,this.logLevel=l}var t=e.prototype;return t.debug=function(e){this.logLevel<=r.DEBUG&&console.debug("[DEBUG]: "+e)},t.info=function(e){this.logLevel<=r.INFO&&console.info("[INFO]: "+e)},t.warn=function(e){this.logLevel<=r.WARN&&console.warn("[WARN]: "+e)},t.error=function(e){this.logLevel<=r.ERROR&&console.error("[ERROR]: "+e)},e}()}}]);